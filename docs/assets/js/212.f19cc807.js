(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{643:function(t,s,a){"use strict";a.r(s);var n=a(36),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker-resources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-resources"}},[t._v("#")]),t._v(" Docker Resources")]),t._v(" "),a("p",[t._v("This is a list of all the resources, both mandatory and optional, used to deploy a full-featured nBold environment on Docker.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("N.B")]),t._v(" "),a("p",[t._v("This documentation is automatically generated from our sample "),a("a",{attrs:{href:"https://www.terraform.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform"),a("OutboundLink")],1),t._v(" configuration file, and is intended to be used as a reference.\nYou'll have to edit the variables and configuration files to specify the appropriate settings for your environment and resources.")])]),t._v(" "),a("p",[a("strong",[t._v("TABLE OF CONTENTS")])]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#deployment-providers"}},[t._v("Deployment providers")])]),a("li",[a("a",{attrs:{href:"#virtual-networks"}},[t._v("Virtual Networks")])]),a("li",[a("a",{attrs:{href:"#backing-services"}},[t._v("Backing services")]),a("ul",[a("li",[a("a",{attrs:{href:"#main-database"}},[t._v("Main Database")])]),a("li",[a("a",{attrs:{href:"#cache-and-queuing-service"}},[t._v("Cache and queuing service")])]),a("li",[a("a",{attrs:{href:"#blob-service"}},[t._v("Blob service")])]),a("li",[a("a",{attrs:{href:"#nosql-service"}},[t._v("NoSQL service")])]),a("li",[a("a",{attrs:{href:"#events-collector-service"}},[t._v("Events collector service")])])])]),a("li",[a("a",{attrs:{href:"#application-services"}},[t._v("Application services")]),a("ul",[a("li",[a("a",{attrs:{href:"#application-image"}},[t._v("Application image")])]),a("li",[a("a",{attrs:{href:"#application-containers"}},[t._v("Application containers")])])])]),a("li",[a("a",{attrs:{href:"#hosting-services"}},[t._v("Hosting services")]),a("ul",[a("li",[a("a",{attrs:{href:"#proxy"}},[t._v("Proxy")])])])]),a("li",[a("a",{attrs:{href:"#monitoring-services"}},[t._v("Monitoring services")]),a("ul",[a("li",[a("a",{attrs:{href:"#metrics-collector"}},[t._v("Metrics collector")])]),a("li",[a("a",{attrs:{href:"#redis-exporter"}},[t._v("Redis exporter")])]),a("li",[a("a",{attrs:{href:"#bull-exporter"}},[t._v("Bull exporter")])]),a("li",[a("a",{attrs:{href:"#uptime-monitoring"}},[t._v("Uptime monitoring")])])])])])]),a("p"),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"deployment-providers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment-providers"}},[t._v("#")]),t._v(" Deployment providers")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("In this example we're using the "),a("a",{attrs:{href:"https://registry.terraform.io/providers/kreuzwerker/docker/latest/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker provider"),a("OutboundLink")],1),t._v(" for Terraform.\nA similar configuration can be used for any other provider, especially "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure RM provider"),a("OutboundLink")],1),t._v(" for Terraform.")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terraform")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("required_providers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kreuzwerker/docker"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"~> 2.13.0"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("provider"),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v(' "docker" ')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"virtual-networks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-networks"}},[t._v("#")]),t._v(" Virtual Networks")]),t._v(" "),a("p",[t._v("The following configuration creates a private virtual network with a subnet for the environment.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_network"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"backing-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backing-services"}},[t._v("#")]),t._v(" Backing services")]),t._v(" "),a("p",[t._v("A backing service is any service the app consumes over the network as part of its normal operation.")]),t._v(" "),a("h3",{attrs:{id:"main-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#main-database"}},[t._v("#")]),t._v(" Main Database")]),t._v(" "),a("p",[t._v("PostgreSQL is used for storing the application configuration (templates, policies, settings...).\nThe following configuration references an image and creates a container for the "),a("a",{attrs:{href:"https://www.postgresql.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL"),a("OutboundLink")],1),t._v(" service.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres:13.4-alpine"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres_main"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.DB_APPLICATION_HOST\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.DB_APPLICATION_HOST\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.postgres.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sample healthcheck command")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# test: [ "CMD", "pg_isready", "-q", "-d", "${DB_APPLICATION_DATABASE_NAME}", "-U", "${DB_APPLICATION_USER}" ]')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POSTGRES_DB='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POSTGRES_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POSTGRES_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Available paths for molumes mapping")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - /var/lib/postgresql/data")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"cache-and-queuing-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-and-queuing-service"}},[t._v("#")]),t._v(" Cache and queuing service")]),t._v(" "),a("p",[t._v("Redis is used for all the caching and queuing mechanisms.\nThe following configuration references an image and creates a container for the "),a("a",{attrs:{href:"https://redis.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis"),a("OutboundLink")],1),t._v(" service.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:alpine"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.REDIS_HOST\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.redis.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start Redis with persistence enabled. See https://redis.io/topics/persistence")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: A warning message may appear ``WARNING overcommit_memory is set to 0! Background save may fail under low memory condition.`")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can safely omit this warning.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# To fix this issue, add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--include"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/etc/redis/redis.conf"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# test: ["CMD", "redis-cli", "ping"]')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/redis/conf/redis.conf"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/etc/redis/redis.conf"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"blob-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blob-service"}},[t._v("#")]),t._v(" Blob service")]),t._v(" "),a("p",[t._v("Azure Storage is used for storing application-generated blobs, such as the templates pictures.\nThe following configuration references an image and creates a container for the "),a("a",{attrs:{href:"https://github.com/Azure/Azurite",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azurite"),a("OutboundLink")],1),t._v(" service, which is lightweight server clone of Azure Storage that simulates most of the commands supported by it with minimal dependencies.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"azure_storage"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mcr.microsoft.com/azure-storage/azurite:latest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"azure_storage"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.AZURESTORAGE_HOST\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.azure_storage.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"azurite"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--blobPort"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10000"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--blobHost"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--queuePort"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10001"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--queueHost"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--tablePort"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10002"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--tableHost"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--loose"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--skipApiVersionCheck"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10001")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10001")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10002")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10002")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"nosql-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql-service"}},[t._v("#")]),t._v(" NoSQL service")]),t._v(" "),a("p",[t._v("Azure CosmosDB is used for storing application-generated objects, such as templates advanced configurations and policies.\nThe following configuration references an image and creates a container for the "),a("a",{attrs:{href:"https://github.com/Azure/azure-cosmos-db-emulator-docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure CosmosDB emulator"),a("OutboundLink")],1),t._v(" service, which is lightweight server clone of Azure CosmosDB that simulates most of the commands supported by it with minimal dependencies.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cosmos_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mcr.microsoft.com/cosmosdb/linux/azure-cosmos-emulator:latest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cosmos_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.COSMOSDB_HOST\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.cosmos_db.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: Keep the partition count high (at least 40) to prevent throttling 503 errors from the emulator. See:")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - https://github.com/Azure/azure-cosmos-dotnet-v2/issues/817")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - https://docs.microsoft.com/en-us/azure/cosmos-db/emulator-command-line-parameters#set-partitioncount")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AZURE_COSMOS_EMULATOR_PARTITION_COUNT=40"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AZURE_COSMOS_EMULATOR_ENABLE_DATA_PERSISTENCE=true"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# To connect to cosmos db emulator, it requires a certificate")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl -k https://localhost:8081/_explorer/emulator.pem > ~/emulatorcert.crt && sudo cp ~/emulatorcert.crt /usr/local/share/ca-certificates/ && sudo update-ca-certificates")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Explorer: https://localhost:8081/_explorer/index.html")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10251")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10251")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10252")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10252")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10253")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10253")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10254")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10254")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"events-collector-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#events-collector-service"}},[t._v("#")]),t._v(" Events collector service")]),t._v(" "),a("p",[t._v("Jitsu may be used to collect and distribute the "),a("RouterLink",{attrs:{to:"/hosting/references/events-reference.html"}},[t._v("application events")]),t._v(" and audit trails.\nThe following configuration references an image and creates a container for the "),a("a",{attrs:{href:"https://github.com/jitsucom/jitsu",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jitsu"),a("OutboundLink")],1),t._v(" service, using the "),a("a",{attrs:{href:"https://jitsu.com/docs/deployment/deploy-with-docker/jitsu-server",target:"_blank",rel:"noopener noreferrer"}},[t._v("@jitsuco/server"),a("OutboundLink")],1),t._v(" standalone image.\nFor isolation purposes, it also provisions a specific PostgreSQL instance for the events database, based on the same image as the main database service.")],1),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres_events"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.AUDITING_SERVICE_DB_AUDIT_HOST\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.postgres.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sample healthcheck command")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# test: [ "CMD", "pg_isready", "-q", "-d", "${DB_APPLICATION_DATABASE_NAME}", "-U", "${DB_APPLICATION_USER}" ]')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POSTGRES_DB='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POSTGRES_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POSTGRES_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5433")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Available paths for molumes mapping")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - /var/lib/postgresql/data")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsu"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsucom/server:latest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsu"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsu_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.jitsu.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis,\n    docker_container.postgres_events\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jitsu\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SERVER_NAME=jitsu_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PORT=8002"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_URL=redis://redis:6379/0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS_SKIP_VERIFY=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"USER_RECOGNITION_ENABLED=false"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SERVER_ADMIN_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/jitsu/conf/eventnative.yaml"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/eventnative/data/config/eventnative.yaml"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   host_path      = "${path.cwd}/volumes/jitsu/logs/server"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   container_path = "/home/eventnative/data/logs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   read_only      = false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"application-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#application-services"}},[t._v("#")]),t._v(" Application services")]),t._v(" "),a("h3",{attrs:{id:"application-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#application-image"}},[t._v("#")]),t._v(" Application image")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("All the application services are based on the same "),a("code",[t._v("nboldhq/nbold")]),t._v(" image.\nContact us to access our secured "),a("a",{attrs:{href:"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Container Registry"),a("OutboundLink")],1),t._v(" or integrate this image to your own private container registry such as "),a("a",{attrs:{href:"https://azure.microsoft.com/en-us/services/container-registry",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Container Registry"),a("OutboundLink")],1),t._v(" to access advanced CI/CD capabilities.")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim/app-platform"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"application-containers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#application-containers"}},[t._v("#")]),t._v(" Application containers")]),t._v(" "),a("p",[t._v("As a multi-tier application, nBold is composed of several services that could be executed and scaled independently.")]),t._v(" "),a("h4",{attrs:{id:"installer-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installer-service"}},[t._v("#")]),t._v(" Installer service")]),t._v(" "),a("p",[t._v("The installer service is responsible for initializing the backing services schemas (databases, blobs containers, etc.).\nIt is run once and exits after the initialization is complete.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_installer"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_installer"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.salestim.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend:setup"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_TLS_REJECT_UNAUTHORIZED=0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_LEVEL=debug"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_DIRECTORY=/volumes/logs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT=http://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AZURESTORAGE_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':10000/devstoreaccount1"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT=https://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("COSMOSDB_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':8081"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_installer"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/salestim/logs/installer"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/volumes/logs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis,\n    docker_container.postgres_main,\n    docker_container.postgres_events,\n    docker_container.azure_storage,\n    docker_container.cosmos_db\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"api-tier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-tier"}},[t._v("#")]),t._v(" Api tier")]),t._v(" "),a("p",[t._v("The api tier could be scaled up and down by configuring the "),a("code",[t._v("scaling_factors.api")]),t._v(" variable.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_api"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_api_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# hostname = "salestim_api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.salestim.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.api\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sample healthcheck command")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Test the monitoring ping endpoint, exits as 0 (success) or exits as 1 (fail)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test: apk update && apk upgrade && apk add --no-cache curl && curl --fail http://localhost:${APP_PORT}/monitoring/ping || exit 1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_TLS_REJECT_UNAUTHORIZED=0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_ROLE=api"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_PORT=3000"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DEPLOY=self"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_LEVEL=debug"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_DIRECTORY=/volumes/logs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT=http://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AZURESTORAGE_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':10000/devstoreaccount1"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT=https://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("COSMOSDB_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':8081"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_INTEGRATION_ENABLED='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_INTEGRATION_ENABLED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_URL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_HEADER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_HEADER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_CLIENT_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_CLIENT_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_SERVER_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_SERVER_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_ADMIN_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_ENDPOINT='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_ENDPOINT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_METHOD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_METHOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WEB_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"API_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_ID='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_SECRET='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_INTEGRATION_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_AUTH_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter_auth_token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_DEFAULT_METRICS=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_GARBAGE_COLLECTOR_METRICS=false"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/salestim/logs/api"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/volumes/logs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis,\n    docker_container.postgres_main,\n    docker_container.postgres_events,\n    docker_container.azure_storage,\n    docker_container.cosmos_db\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"web-tier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-tier"}},[t._v("#")]),t._v(" Web tier")]),t._v(" "),a("p",[t._v("The web tier could be scaled up and down by configuring the "),a("code",[t._v("scaling_factors.web")]),t._v(" variable.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_web"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_web_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.salestim.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.web\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sample healthcheck command")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Test the monitoring ping endpoint, exits as 0 (success) or exits as 1 (fail)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test: apk update && apk upgrade && apk add --no-cache curl && curl --fail http://localhost:${APP_PORT}/monitoring/ping || exit 1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_TLS_REJECT_UNAUTHORIZED=0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_ROLE=web"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_PORT=3000"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DEPLOY=self"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_LEVEL=debug"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_DIRECTORY=/volumes/logs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT=http://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AZURESTORAGE_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':10000/devstoreaccount1"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT=https://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("COSMOSDB_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':8081"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_INTEGRATION_ENABLED='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_INTEGRATION_ENABLED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_URL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_HEADER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_HEADER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_CLIENT_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_CLIENT_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_SERVER_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_SERVER_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_ADMIN_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_ENDPOINT='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_ENDPOINT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_METHOD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_METHOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WEB_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"API_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_ID='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_SECRET='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_INTEGRATION_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_AUTH_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter_auth_token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_DEFAULT_METRICS=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_GARBAGE_COLLECTOR_METRICS=false"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/salestim/logs/web"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/volumes/logs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis,\n    docker_container.postgres_main,\n    docker_container.postgres_events,\n    docker_container.azure_storage,\n    docker_container.cosmos_db\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"jobs-tier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jobs-tier"}},[t._v("#")]),t._v(" Jobs tier")]),t._v(" "),a("p",[t._v("The jobs tier could be scaled up and down by configuring the "),a("code",[t._v("scaling_factors.jobs")]),t._v(" variable.")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_jobs"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_jobs_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.salestim.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jobs\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sample healthcheck command")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Test the monitoring ping endpoint, exits as 0 (success) or exits as 1 (fail)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test: apk update && apk upgrade && apk add --no-cache curl && curl --fail http://localhost:${APP_PORT}/monitoring/ping || exit 1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_TLS_REJECT_UNAUTHORIZED=0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_ROLE=jobs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_PORT=3000"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DEPLOY=self"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_LEVEL=debug"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_DIRECTORY=/volumes/logs"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT=http://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AZURESTORAGE_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':10000/devstoreaccount1"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT=https://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("COSMOSDB_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':8081"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_INTEGRATION_ENABLED='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_INTEGRATION_ENABLED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_URL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_HEADER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_HEADER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_CLIENT_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_CLIENT_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_SERVER_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_SERVER_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_ADMIN_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_ENDPOINT='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_ENDPOINT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_METHOD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_METHOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WEB_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"API_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_ID='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_SECRET='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_INTEGRATION_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_AUTH_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter_auth_token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_DEFAULT_METRICS=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_GARBAGE_COLLECTOR_METRICS=false"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/salestim/logs/jobs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/volumes/logs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis,\n    docker_container.postgres_main,\n    docker_container.postgres_events,\n    docker_container.azure_storage,\n    docker_container.cosmos_db\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("Exception")]),t._v(" "),a("p",[t._v("As an exception, the scheduler service "),a("strong",[t._v("MUST")]),t._v(" be executed by "),a("strong",[t._v("one and only one")]),t._v(" container.")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_scheduler"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_scheduler"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"salestim_scheduler"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.salestim.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sample healthcheck command")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Test the monitoring ping endpoint, exits as 0 (success) or exits as 1 (fail)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# test: apk update && apk upgrade && apk add --no-cache curl && curl --fail http://localhost:${APP_PORT}/monitoring/ping || exit 1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_TLS_REJECT_UNAUTHORIZED=0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_ROLE=scheduler"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_PORT=3000"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DEPLOY=self"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_LEVEL=debug"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LOG_PERSISTENCY_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DB_APPLICATION_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("DB_APPLICATION_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_HOST='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_DATABASE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_USER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_DB_AUDIT_PASSWORD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AUDITING_SERVICE_DB_AUDIT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT=http://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("AZURESTORAGE_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':10000/devstoreaccount1"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT=https://'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("COSMOSDB_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(':8081"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_INTEGRATION_ENABLED='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_INTEGRATION_ENABLED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_URL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_HEADER='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_HEADER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_CLIENT_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_CLIENT_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_SERVER_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_SERVER_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_AUTH_ADMIN_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_ENDPOINT='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_ENDPOINT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AUDITING_SERVICE_TRACK_METHOD='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AUDITING_SERVICE_TRACK_METHOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WEB_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"API_PUBLICURL='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("proxy_urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_ID='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MICROSOFT_AZURE_AD_APP_CLIENT_SECRET='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_INTEGRATION_ENABLED=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_AUTH_TOKEN='),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporter_auth_token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_DEFAULT_METRICS=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROMETHEUS_EXPORTER_COLLECT_GARBAGE_COLLECTOR_METRICS=false"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/salestim/logs/scheduler"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/volumes/logs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis,\n    docker_container.postgres_main,\n    docker_container.postgres_events,\n    docker_container.azure_storage,\n    docker_container.cosmos_db\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"hosting-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hosting-services"}},[t._v("#")]),t._v(" Hosting services")]),t._v(" "),a("h3",{attrs:{id:"proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy"}},[t._v("#")]),t._v(" Proxy")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("In this example we're using "),a("a",{attrs:{href:"https://www.nginx.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx"),a("OutboundLink")],1),t._v(" as a proxy, without specific additional load balancer or firewall.\nA similar configuration can be used to configure another service more suitable for production environments, such as "),a("a",{attrs:{href:"https://azure.microsoft.com/en-us/services/frontdoor",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Front Door"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx:latest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.nginx.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.salestim_api,\n    docker_container.salestim_web,\n    docker_container.salestim_jobs,\n    docker_container.salestim_scheduler,\n    docker_container.jitsu\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/nginx/conf/nginx.conf"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/nginx/nginx.conf"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/nginx/logs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/log/nginx"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3001")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3001")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3002")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3002")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3003")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3003")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3004")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3004")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"monitoring-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-services"}},[t._v("#")]),t._v(" Monitoring services")]),t._v(" "),a("p",[t._v("These optional services are used to monitor the performance of the application and collect advanced metrics.")]),t._v(" "),a("h3",{attrs:{id:"metrics-collector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics-collector"}},[t._v("#")]),t._v(" Metrics collector")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("In this example we're using "),a("a",{attrs:{href:"https://prometheus.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),a("OutboundLink")],1),t._v(" as a metrics collector that could be used for alerting and basic reporting.\nFor advanced dashboarding capabilities, you can use "),a("a",{attrs:{href:"https://grafana.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grafana"),a("OutboundLink")],1),t._v(" or "),a("a",{attrs:{href:"https://www.elastic.co/kibana/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kibana"),a("OutboundLink")],1),t._v(" connected to this Prometheus instance.\nA similar configuration can be used to configure other services, such as "),a("a",{attrs:{href:"https://azure.microsoft.com/en-us/services/monitor",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Monitor"),a("OutboundLink")],1),t._v(" and "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Application Insights"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prom/prometheus"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.prometheus.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.salestim_api,\n    docker_container.salestim_web,\n    docker_container.salestim_jobs,\n    docker_container.salestim_scheduler\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/prometheus/conf/prometheus.yml"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/prometheus/prometheus.yml"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("In addition to collecting the core application services metrics, Prometheus can also collect additional metrics from other services using "),a("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exporters/",target:"_blank",rel:"noopener noreferrer"}},[t._v("exporters"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"redis-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-exporter"}},[t._v("#")]),t._v(" Redis exporter")]),t._v(" "),a("p",[t._v("The "),a("a",{attrs:{href:"https://github.com/oliver006/redis_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Prometheus exporter"),a("OutboundLink")],1),t._v(" exposes metrics from the Redis service")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"oliver006/redis_exporter"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis_prometheus_exporter"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.redis_prometheus_exporter.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--redis.addr=redis_svc:6379"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REDIS_HOST=redis:6379")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REDIS_EXPORTER_DEBUG=true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REDIS_EXPORTER_COUNT_KEYS=[db0=st:sessions:*]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_PASSWORD="')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_EXPORTER_WEB_LISTEN_ADDRESS=0.0.0.0:9121"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_EXPORTER_WEB_TELEMETRY_PATH=/metrics"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_EXPORTER_NAMESPACE=redis"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_EXPORTER_INCL_SYSTEM_METRICS=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_EXPORTER_SKIP_TLS_VERIFICATION=true"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REDIS_EXPORTER_PING_ON_CONNECT=true"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9121")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9121")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"bull-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bull-exporter"}},[t._v("#")]),t._v(" Bull exporter")]),t._v(" "),a("p",[t._v("The "),a("a",{attrs:{href:"https://github.com/UpHabit/bull_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bull Prometheus exporter"),a("OutboundLink")],1),t._v(" exposes metrics from the queuing service based on Redis")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uphabit/bull_exporter:latest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_prometheus_exporter"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.bull_prometheus_exporter.latest\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.redis\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EXPORTER_REDIS_URL=redis://redis:6379/0"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EXPORTER_PREFIX=st:queues"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EXPORTER_STAT_PREFIX=bull_queue_"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9538")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9538")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"uptime-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uptime-monitoring"}},[t._v("#")]),t._v(" Uptime monitoring")]),t._v(" "),a("p",[t._v("The uptime monitoring service is used to monitor the uptime of the application.")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("In this example we're using the "),a("a",{attrs:{href:"https://monika.hyperjump.tech",target:"_blank",rel:"noopener noreferrer"}},[t._v("Monika"),a("OutboundLink")],1),t._v(" application, but you can use another monitoring service, such as the integrated health probes from "),a("a",{attrs:{href:"https://azure.microsoft.com/en-us/services/frontdoor",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Front Door"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_image"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hyperjump/monika:latest"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("keep_locally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"docker_container"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("image")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" docker_image.monika.latest\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run Monika in the background and expose its Prometheus metrics")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/config/monika.yml"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--prometheus"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3010"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("networks_advanced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("internal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3010")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("external")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3010")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volumes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_path")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("cwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/volumes/monika/conf/monika.yml"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/config/monika.yml"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("read_only")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("depends_on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    docker_container.salestim_api,\n    docker_container.salestim_web,\n    docker_container.salestim_jobs,\n    docker_container.salestim_scheduler\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);